<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- 引入 ECharts 文件 -->    
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=CHMKtgBvVzGBKtM9ayW5f0zLOpZYrtVH"></script>

    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/dark.js"></script>
    <script src="/static/js/router.js"></script>
    <!-- <script src="/static/js/homeOptionInit.js"></script> -->
    <script src="/static/js/trafficOptionInit.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>
    
    <script src="/static/js/d3.min.js"></script>
    <script src="/static/js/library/d3-tip.js"></script>

  </head>
  <body>
    <!-- <div id="main" class="chart" style="width: 100%; height: 450px;"></div> -->
    <!-- <div id="main" class="chart" style="margin-left:5%;width: 90%; height: 450px;"></div> -->


    <svg width="1600" height="700" id="mainsvg" class="svgs"></svg>
    <!-- <svg style="margin-left:5%;width: 90%; height: 450px;" id="mainsvg" class="svgs"></svg> -->
  </body>
</html>
<script>

  // let myChart = echarts.init(document.getElementById("main"));
  // myChart.showLoading()
  //       myChart.hideLoading()
  //       const option = initTrafficMap()
  //       myChart.setOption(option)


  let svg = d3.select('svg');
  const width = +svg.attr('width');
  const height = +svg.attr('height');
  console.log(width, height)
  const margin = {top: 60, right: 60, bottom: 10, left: 60};
  const innerWidth = width - margin.left - margin.right;
  const innerHeight = height - margin.top - margin.bottom;
  const g = svg.append('g').attr('id', 'maingroup')
  .attr('transform', `translate(${margin.left}, ${margin.top})`);
  const tip = d3.tip()
    .attr('class', 'd3-tip').html(function(d) { return d.properties.name });
  svg.call(tip);

  fetch('/json/subway')
  .then((response) => response.json())
  .then(function (res) {
    console.log(res)
    let projection = d3.geoEquirectangular()
    let pathGenerator = d3.geoPath().projection(projection);
    
    projection.fitSize([innerWidth, innerHeight ], res);

    // perform data-join; 
    const paths = g.selectAll('path')
    .data(res.features, d => d.properties.name)
    .enter().append('path')
    .attr('d', pathGenerator)
    .attr('stroke', 'black')
    .attr('stroke-width', 1)
    .style("fill", 'none')
    .on('zoom', () => {
      svg.attr('transform', d3.event.transform) // 添加缩放功能
      this.axises.xContainer.call(this.axises.x.scale(d3.event.transform.rescaleX(this.axises.xScale))) // 设置坐标轴随zoom缩放
      this.axises.yContainer.call(this.axises.y.scale(d3.event.transform.rescaleY(this.axises.yScale)))
    })
  })

</script>
<style>
  /* .chart {
    text-align: center;
    z-index: 1;
  } */
  body {
    margin: 0px;
    /* background-color: rgb(0, 1, 3); */
  }


</style>